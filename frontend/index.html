<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>IoT Room Control - ƒêƒÉng nh·∫≠p</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #020617;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    .portal-wrapper {
      width: 900px;
      max-width: 95vw;
      background: rgba(255, 255, 255, 0.18);
      border-radius: 18px;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex;
      position: relative;
      overflow: visible;
    }

    .portal-left {
      width: 40%;
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
      color: #fff;
      padding: 40px 40px 40px 60px;
      display: none;
      flex-direction: column;
      justify-content: center;
      position: relative;
    }

    .portal-logo {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 1px;
      margin-bottom: 24px;
      line-height: 1.4;
    }

    .portal-right {
      width: 100%;
      padding: 32px 40px 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
    }

    #auth-card { position: relative; }

    .hello-title {
      font-size: 32px;
      font-weight: 800;
      text-align: center;
      color: #1565c0;
      margin-top: 10px;
      margin-bottom: 8px;
    }

    .hello-sub {
      margin-top: 4px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #0b1f3b;
      text-align: center;
    }

    .form-group { margin-bottom: 14px; }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #333;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      padding: 4px 14px;
      background: #f9fafb;
    }

    .input-wrapper span.icon {
      margin-right: 8px;
      color: #888;
      font-size: 14px;
    }

    .input-wrapper input {
      border: none;
      outline: none;
      background: transparent;
      flex: 1;
      font-size: 14px;
      padding: 6px 0;
    }

    /* th√™m cho select ƒë·ªÉ nh√¨n gi·ªëng input */
    .input-wrapper select {
      border: none;
      outline: none;
      background: transparent;
      flex: 1;
      font-size: 14px;
      padding: 6px 0;
      color: #111;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    .input-wrapper select:invalid {
      color: #9ca3af; /* m√†u placeholder khi ch∆∞a ch·ªçn */
    }

    button.primary-btn {
      border: none;
      outline: none;
      border-radius: 999px;
      background: #1565c0;
      color: #fff;
      padding: 10px 32px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: background 0.18s ease, transform 0.08s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }

    button.primary-btn:hover {
      background: #c62828;
      transform: translateY(-1px);
    }

    .toggle-link {
      margin-top: 10px;
      font-size: 13px;
      color: #1565c0;
      cursor: pointer;
      text-align: center;
    }

    .toggle-link:hover { text-decoration: underline; }

    .auth-extra-links {
      margin-top: 8px;
      font-size: 13px;
      text-align: center;
    }

    .auth-extra-links a {
      color: #1565c0;
      text-decoration: none;
      margin: 0 4px;
    }

    .auth-extra-links a:hover { text-decoration: underline; }

    .hidden { display: none; }

    .small-text {
      font-size: 12px;
      color: #777;
      margin-top: 10px;
      text-align: center;
    }

    .log-card {
      width: 1100px;
      max-width: 95vw;
      margin-top: 18px;
      padding: 10px 14px;
      background: rgba(0,0,0,0.9);
      color: #0f0;
      border-radius: 10px;
      font-size: 12px;
      max-height: 160px;
      overflow: auto;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
      display: none;
    }

    .log-card-title {
      color: #fff;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .realtime-clock {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 9999;
      padding: 12px 26px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
      font-size: 18px;
      font-weight: 500;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
    }

    @media (max-width: 900px) {
      .portal-wrapper { flex-direction: column; }
      .portal-left, .portal-right { width: 100%; }
      .portal-left { border-radius: 18px 18px 0 0; }
    }
  </style>
</head>
<body>
  <div class="portal-wrapper">
    <!-- B√™n tr√°i t·∫°m ·∫©n, kh√¥ng logo -->
    <div class="portal-left">
      <div class="portal-logo">
        Welcome to the arena of discipline
      </div>
    </div>

    <!-- B√™n ph·∫£i: login / register -->
    <div class="portal-right">
      <div id="auth-card">
        <h1 class="hello-title">XIN CH√ÄO!</h1>
        <p class="hello-sub">
          ƒêƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng h·ªá th·ªëng gi√°m s√°t &amp; ƒëi·ªÅu khi·ªÉn ph√≤ng IoT.
        </p>

        <!-- LOGIN -->
        <div id="login-section">
          <div class="form-group">
            <label>Email</label>
            <div class="input-wrapper">
              <span class="icon">üë§</span>
              <input type="email" id="login-email" placeholder="Nh·∫≠p email c·ªßa b·∫°n" />
            </div>
          </div>
          <div class="form-group">
            <label>M·∫≠t kh·∫©u</label>
            <div class="input-wrapper">
              <span class="icon">üîí</span>
              <input type="password" id="login-pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" maxlength="72" />
            </div>
          </div>

          <button class="primary-btn" onclick="login()">ƒêƒÇNG NH·∫¨P</button>
          <div class="auth-extra-links">
            <a href="/forgot-password">Qu√™n m·∫≠t kh·∫©u?</a>
            <span>‚Ä¢</span>
            <a href="#" onclick="forgotEmail(event)">Qu√™n t√†i kho·∫£n?</a>
          </div>

          <div class="toggle-link" onclick="showRegister()">
            Nh√¢n vi√™n m·ªõi? <b>ƒêƒÉng k√Ω t√†i kho·∫£n</b>
          </div>
        </div>

        <!-- REGISTER -->
        <div id="register-section" class="hidden">
          <!-- H·ªç v√† t√™n -->
          <div class="form-group">
            <label>H·ªç v√† t√™n</label>
            <div class="input-wrapper">
              <span class="icon">üßë</span>
              <input type="text" id="reg-fullname" placeholder="Nh·∫≠p h·ªç v√† t√™n" />
            </div>
          </div>

          <!-- Ng√†y sinh -->
          <div class="form-group">
            <label>Ng√†y sinh</label>
            <div class="input-wrapper">
              <span class="icon">üéÇ</span>
              <input type="date" id="reg-dob" />
            </div>
          </div>

          <!-- Ch·ª©c v·ª•: CHUY·ªÇN TH√ÄNH SELECT -->
          <div class="form-group">
            <label>Ch·ª©c v·ª•</label>
            <div class="input-wrapper">
              <span class="icon">üíº</span>
              <select id="reg-position" required>
                <option value="" disabled selected hidden>Ch·ªçn ch·ª©c v·ª•</option>
                <option value="Nh√¢n vi√™n kinh doanh">Nh√¢n vi√™n kinh doanh</option>
                <option value="Nh√¢n vi√™n IoT">Nh√¢n vi√™n IoT</option>
                <option value="Nh√¢n vi√™n k·ªπ thu·∫≠t">Nh√¢n vi√™n k·ªπ thu·∫≠t</option>
                <option value="Nh√¢n vi√™n h√†nh ch√≠nh">Nh√¢n vi√™n h√†nh ch√≠nh</option>
                <option value="Qu·∫£n l√Ω ph√≤ng">Qu·∫£n l√Ω ph√≤ng</option>
                <option value="Kh√°c">Kh√°c</option>
              </select>
            </div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label>Email</label>
            <div class="input-wrapper">
              <span class="icon">üìß</span>
              <input type="email" id="reg-email" placeholder="Nh·∫≠p email ƒë·ªÉ ƒëƒÉng k√Ω" />
            </div>
          </div>

          <!-- M·∫≠t kh·∫©u -->
          <div class="form-group">
            <label>M·∫≠t kh·∫©u</label>
            <div class="input-wrapper">
              <span class="icon">üîë</span>
              <input type="password" id="reg-pass" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±" maxlength="72" />
            </div>
          </div>

          <button class="primary-btn" onclick="register()">ƒêƒÇNG K√ù</button>
          <div class="toggle-link" onclick="showLogin()">
            ƒê√£ c√≥ t√†i kho·∫£n? <b>ƒêƒÉng nh·∫≠p</b>
          </div>
        </div>

        <p class="small-text" id="auth-status"></p>
      </div>
    </div>
  </div>

  <!-- log ·∫©n -->
  <div class="log-card">
    <div class="log-card-title">Client log</div>
    <pre id="log"></pre>
  </div>

  <!-- ƒë·ªìng h·ªì -->
  <div class="realtime-clock" id="realtime-clock"></div>

  <script>
    const API_BASE = "";

    function log(msg) {
      const box = document.getElementById("log");
      if (!box) return;
      box.textContent += msg + "\n";
      box.scrollTop = box.scrollHeight;
    }

    function showRegister() {
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("register-section").classList.remove("hidden");
    }

    function showLogin() {
      document.getElementById("register-section").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
    }

    async function register() {
      const full_name = document.getElementById("reg-fullname").value.trim();
      const date_of_birth = document.getElementById("reg-dob").value; // yyyy-mm-dd
      const position = document.getElementById("reg-position").value; // l·∫•y t·ª´ select
      const email = document.getElementById("reg-email").value.trim();
      const pass = document.getElementById("reg-pass").value.trim();

      if (!full_name || !date_of_birth || !position || !email || !pass) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß h·ªç t√™n, ng√†y sinh, ch·ª©c v·ª•, email v√† m·∫≠t kh·∫©u.");
        return;
      }

      if (pass.length < 6) {
        alert("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.");
        return;
      }

      const payload = {
        email,
        password: pass,
        full_name,
        date_of_birth,
        position
        // start_date s·∫Ω ƒë∆∞·ª£c backend t·ª± ƒë·∫∑t = ng√†y ƒëƒÉng k√Ω
      };

      try {
        const res = await fetch(API_BASE + "/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
          alert("ƒêƒÉng k√Ω th·∫•t b·∫°i: " + (data.detail || res.status));
          log("Register failed: " + JSON.stringify(data));
        } else {
          alert("ƒêƒÉng k√Ω th√†nh c√¥ng, b√¢y gi·ªù h√£y ƒëƒÉng nh·∫≠p.");
          log("Registered: " + JSON.stringify(data));
          showLogin();
          document.getElementById("login-email").value = email;
        }
      } catch (e) {
        alert("L·ªói m·∫°ng khi ƒëƒÉng k√Ω");
        log("Register error: " + e);
      }
    }

    async function login() {
      const email = document.getElementById("login-email").value.trim();
      const pass = document.getElementById("login-pass").value.trim();
      if (!email || !pass) {
        alert("Nh·∫≠p email v√† m·∫≠t kh·∫©u ƒë·ªÉ ƒëƒÉng nh·∫≠p");
        return;
      }
      try {
        const body = new URLSearchParams();
        body.append("username", email);
        body.append("password", pass);

        const res = await fetch(API_BASE + "/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body,
        });
        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          alert("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: " + (data.detail || res.status));
          log("Login failed: " + JSON.stringify(data));
          return;
        }

        const token = data.access_token;
        if (!token) {
          alert("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: kh√¥ng nh·∫≠n ƒë∆∞·ª£c token.");
          log("Login missing token: " + JSON.stringify(data));
          return;
        }

        localStorage.setItem("access_token", token);
        localStorage.setItem("user_email", email);

        log("Login success, redirect to /dashboard");
        window.location.href = "/dashboard";
      } catch (e) {
        alert("L·ªói m·∫°ng khi ƒëƒÉng nh·∫≠p");
        log("Login error: " + e);
      }
    }

    function forgotEmail(event) {
      event.preventDefault();
      alert("N·∫øu b·∫°n qu√™n email/t√†i kho·∫£n, h√£y li√™n h·ªá qu·∫£n tr·ªã h·ªá th·ªëng ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.");
    }

    function updateClock() {
      const clockEl = document.getElementById("realtime-clock");
      if (!clockEl) return;
      const now = new Date();
      const time = now.toLocaleTimeString("vi-VN", {
        hour: "2-digit",
        minute: "2-digit",
        hour12: false,
      });
      clockEl.textContent = time;
    }
    updateClock();
    setInterval(updateClock, 1000);

    function setTimeTheme() {
      const hour = new Date().getHours();
      let bg = "/static/Morning2.png";
      if (hour >= 5 && hour < 11) bg = "/static/Morning2.png";
      else if (hour >= 11 && hour < 14) bg = "/static/Lunch2.png";
      else if (hour >= 14 && hour < 18) bg = "/static/Afternoon2.png";
      else bg = "/static/Night2.png";
      document.body.style.backgroundImage = `url('${bg}')`;
    }
    setTimeTheme();
    setInterval(setTimeTheme, 10 * 60 * 1000);
  </script>
</body>
</html>
